# ============================================================================
# AI分析服务 - 环境变量配置
# ============================================================================

# 服务配置
APP_ENV=development
AI_SERVICE_HOST=0.0.0.0
AI_SERVICE_PORT=5678

# 后端API配置
BACKEND_API_URL=http://localhost:4001
AI_SERVICE_TOKEN=dev-ai-service-token-2024

# MediaMTX配置
MEDIAMTX_HOST=http://192.168.0.95:8889

# 日志配置
LOG_LEVEL=INFO
LOG_FORMAT=json

# ============================================================================
# Web管理页面配置（新增）
# ============================================================================

# Web管理页面地址（用于错误提示跳转）
WEB_ADMIN_URL=http://localhost:4000

# ============================================================================
# 模型启动配置
# ============================================================================

# 启动时是否强制要求模型存在
# - true: 模型缺失时服务拒绝启动（生产环境推荐）
# - false: 模型缺失时服务降级启动（开发环境推荐）
REQUIRE_MODELS_ON_STARTUP=false

# Hugging Face镜像配置（中国大陆推荐使用hf-mirror）
# 可选值:
# - https://hf-mirror.com (国内镜像，推荐)
# - https://huggingface.co (官方，可能需要代理)
HF_ENDPOINT=https://hf-mirror.com

# 模型存储路径（强制使用项目目录，方便统一管理）
# 说明：
# - DeepFace会在DEEPFACE_HOME下创建.deepface/weights/子目录
# - 所有DeepFace相关模型（情绪识别+人脸检测器）都存储在这里
# - YOLOv8检测器也会下载到deepface_models/.deepface/weights/yolov8n-face.pt
DEEPFACE_HOME=./models/deepface_models
MODELSCOPE_CACHE=./models/emotion2vec_models

# DeepFace配置（人脸检测后端）
# 可选: opencv, ssd, mtcnn, retinaface, yolov8, yunet, fastmtcnn, mediapipe
# 推荐: yolov8 (最准确) 或 retinaface (平衡)
DEEPFACE_BACKEND=yolov8
DEEPFACE_ENFORCE_DETECTION=false

# emotion2vec配置
# 注意：模型固定为emotion2vec_plus_seed，由Web管理页面统一下载
EMOTION2VEC_SAMPLE_RATE=16000

# 性能配置
MAX_CONCURRENT_STREAMS=5
FRAME_SKIP_INTERVAL=2
BATCH_SIZE=10

# 数据配置
DATA_COMPRESSION=true
CHECKPOINT_INTERVAL=5

# ============================================================================
# Redis配置（实时数据推送）
# ============================================================================

# Redis服务地址（Docker容器端口6380）
REDIS_HOST=localhost
REDIS_PORT=6380
REDIS_DB=0
REDIS_PASSWORD=
REDIS_REALTIME_ENABLED=true

# ============================================================================
# 重要说明 - 纯离线模式架构
# ============================================================================
#
# 📌 模型管理方式（2.0新架构）：
#
# 1. 模型下载/更新：
#    - 所有模型通过 Web管理页面 统一管理
#    - AI服务不再自动下载模型
#    - 访问地址：http://localhost:4000/dashboard/ai-models
#
# 2. 首次启动前：
#    ⚠️ 必须先下载模型，否则服务无法正常工作
#    - 访问Web管理页面下载DeepFace和emotion2vec模型
#    - 或设置 REQUIRE_MODELS_ON_STARTUP=false 允许降级启动
#
# 3. 模型存储位置：
#    - DeepFace: ./models/deepface_models/.deepface/weights/
#    - emotion2vec: ./models/emotion2vec_models/models/iic/emotion2vec_plus_seed/
#
# 4. 启动检查：
#    - REQUIRE_MODELS_ON_STARTUP=true:  模型缺失时服务拒绝启动（生产环境）
#    - REQUIRE_MODELS_ON_STARTUP=false: 模型缺失时服务降级启动（开发环境）
#
# 5. 健康检查API：
#    - GET /health/models - 查询模型状态（供Web管理页面使用）
#    - POST /api/models/verify/{model_type} - 验证模型完整性
#
# 6. 优势：
#    ✅ 启动速度：从30-60秒降至10秒
#    ✅ 完全离线：不依赖任何外部网络
#    ✅ 可控更新：管理员主动决定何时更新模型
#    ✅ 生产稳定：避免自动更新导致的意外问题
#
